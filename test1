foreach ($file in $files) {
    try {
        Write-Output "Executing $($file.Path) with arguments $($file.Args)"
        $command = "& `"$($file.Path)`" $($file.Args)"
        Write-Output "Command: $command" | Out-File -Append -FilePath C:\Path\To\CommandLog.log

        # Execute the command
        & "$($file.Path)" $file.Args.Split(' ')

        # Check the exit code
        if ($LASTEXITCODE -ne 0) {
            Write-Error "Error: $($file.Path) failed with exit code $LASTEXITCODE"
            throw "Execution aborted due to failure."
        }
    } catch {
        Write-Error "Exception occurred while executing $($file.Path): $_.Exception.Message"
        throw $_
    }
}
